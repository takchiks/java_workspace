package com.cogent.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.cogent.exception.ProductNotFoundException;
import com.cogent.model.Product;
import com.cogent.repo.ProductRepo;

@RestController
//@RequestMapping(path = "/products")
public class ProductController {
	@Autowired
	private ProductRepo productRepo;
	
	@GetMapping
	public ResponseEntity<List<Product>> getAllProduct(){
		return new ResponseEntity<List<Product>>(productRepo.findAll(),HttpStatus.OK);
	}
	@PostMapping("/products")
	public ResponseEntity addProduct(@RequestBody Product product) {
		productRepo.save(product);
		return new ResponseEntity ("Successfully added!",HttpStatus.OK);
	}
	@GetMapping(path = "/products/{pid}")
	public ResponseEntity<Product> getById(@PathVariable(name = "pid") int pid) throws ProductNotFoundException{
		return new ResponseEntity<Product>(productRepo.findById(pid).orElseThrow(()->new ProductNotFoundException()),HttpStatus.OK);
	}
	@GetMapping(path = "/products")
	public ResponseEntity<List<Product>> getByCategory(@RequestParam(name = "cat",required = false) String cat){
		return new ResponseEntity<List<Product>>(productRepo.findByCategory(cat),HttpStatus.OK);
	}
	
	@PutMapping("/products")
	public ResponseEntity updateProduct(@RequestBody Product product) {
		productRepo.save(product);
		return new ResponseEntity ("Successfully Updated!",HttpStatus.OK);
	}
	@DeleteMapping(path = "{pid}")
	public ResponseEntity deleteProduct(@PathVariable(name = "pid") int pid) {
		productRepo.deleteById(pid);
		return new ResponseEntity ("Successfully Deleted!",HttpStatus.OK);
	}
	
	@GetMapping(path = "./?minPrice={minp}&&maxPrice={maxp}")
	public ResponseEntity<List<Product>> getBetweenProduct(@RequestParam(name = "minp",defaultValue = "0.0") double minp,@RequestParam(name = "maxp",defaultValue = "100000.0") double maxp ){
		List<Product> products = productRepo.findAll();
		for(Product p:products) {
			if(p.getPrice()< minp || p.getPrice()>maxp ) {
				products.remove(p);
			}
			
		} 
		return new ResponseEntity<List<Product>>(products,HttpStatus.OK);
	}
	

}
